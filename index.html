<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crescendo Academy - CSV Import FIX</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: #1a2a6c;
            color: white;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #f1c40f;
            margin-bottom: 10px;
        }
        
        .upload-section {
            background: rgba(0,0,0,0.4);
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px dashed rgba(255,255,255,0.3);
        }
        
        .file-input {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 5px;
            color: white;
        }
        
        button {
            padding: 12px 24px;
            background: #f1c40f;
            color: #1a2a6c;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #e67e22;
        }
        
        .website-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .website-card {
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .website-card h3 {
            color: #f1c40f;
            margin-bottom: 10px;
        }
        
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .preview-table th, .preview-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .preview-table th {
            background: rgba(241, 196, 15, 0.2);
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéµ Crescendo Academy - CSV Import FIXED</h1>
            <p>Simple CSV import that actually works!</p>
        </header>
        
        <div class="upload-section">
            <h2>üìÅ CSV File Upload</h2>
            <p>Upload your CSV file with websites (one URL per line):</p>
            
            <input type="file" id="csvFile" class="file-input" accept=".csv">
            
            <div style="margin: 20px 0;">
                <button onclick="importCSV()">üì§ Import CSV</button>
                <button onclick="downloadSampleCSV()">üì• Download Sample CSV</button>
                <button onclick="addDemoWebsites()">üéÆ Add Demo Websites</button>
            </div>
            
            <div id="csvPreview" style="display: none;">
                <h3>üîç CSV Preview:</h3>
                <table class="preview-table" id="previewTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>URL</th>
                            <th>Name</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        
        <div class="website-grid" id="websiteGrid">
            <div style="text-align: center; padding: 40px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                <h3>üìÅ No websites loaded</h3>
                <p>Upload a CSV file or use demo websites</p>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">Message</div>

    <script>
        // SIMPLE CSV IMPORT THAT ACTUALLY WORKS
        function importCSV() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification("‚ùå Please select a CSV file first!");
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const text = e.target.result;
                    console.log("CSV Content:", text); // Debug
                    
                    const websites = parseCSV(text);
                    console.log("Parsed websites:", websites); // Debug
                    
                    if (websites.length === 0) {
                        showNotification("‚ùå No valid URLs found in CSV!");
                        return;
                    }
                    
                    // Show preview
                    showPreview(websites);
                    
                    // Load websites
                    loadWebsites(websites);
                    
                    showNotification(`‚úÖ Imported ${websites.length} websites successfully!`);
                    
                } catch (error) {
                    console.error("CSV Error:", error);
                    showNotification("‚ùå Error reading CSV file!");
                }
            };
            
            reader.onerror = function() {
                showNotification("‚ùå Error reading file!");
            };
            
            reader.readAsText(file);
        }
        
        function parseCSV(csvText) {
            const websites = [];
            const lines = csvText.split('\n');
            
            console.log("Total lines:", lines.length); // Debug
            
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();
                if (!line) continue;
                
                console.log(`Line ${i}: "${line}"`); // Debug
                
                // Try different CSV parsing methods
                let url = '';
                let name = '';
                
                // Method 1: Check if line has comma
                if (line.includes(',')) {
                    const parts = line.split(',');
                    url = parts[0].trim().replace(/"/g, '');
                    name = parts[1] ? parts[1].trim().replace(/"/g, '') : `Site ${i+1}`;
                } else {
                    // Method 2: Whole line is URL
                    url = line.replace(/"/g, '');
                    name = `Site ${i+1}`;
                }
                
                // Clean URL - remove http://, https://, www.
                let cleanUrl = url.toLowerCase();
                cleanUrl = cleanUrl.replace(/^https?:\/\//, '');
                cleanUrl = cleanUrl.replace(/^www\./, '');
                cleanUrl = cleanUrl.split('/')[0]; // Remove paths
                
                // Validate URL
                if (cleanUrl && cleanUrl.includes('.') && cleanUrl.length > 3) {
                    websites.push({
                        url: cleanUrl,
                        name: name,
                        fullUrl: 'https://' + cleanUrl
                    });
                    console.log(`Added: ${cleanUrl} as ${name}`); // Debug
                }
            }
            
            return websites;
        }
        
        function showPreview(websites) {
            const previewDiv = document.getElementById('csvPreview');
            const tbody = document.querySelector('#previewTable tbody');
            
            tbody.innerHTML = '';
            
            const displayCount = Math.min(10, websites.length);
            
            for (let i = 0; i < displayCount; i++) {
                const site = websites[i];
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${site.url}</td>
                    <td>${site.name}</td>
                `;
                
                tbody.appendChild(row);
            }
            
            previewDiv.style.display = 'block';
        }
        
        function loadWebsites(websites) {
            const grid = document.getElementById('websiteGrid');
            
            if (websites.length === 0) {
                grid.innerHTML = `
                    <div style="text-align: center; padding: 40px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                        <h3>üìÅ No websites loaded</h3>
                        <p>Upload a CSV file or use demo websites</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            websites.forEach((site, index) => {
                html += `
                    <div class="website-card">
                        <h3>${site.name}</h3>
                        <p><strong>URL:</strong> ${site.url}</p>
                        <p><strong>Full URL:</strong> ${site.fullUrl}</p>
                        <div style="margin-top: 15px;">
                            <button onclick="visitWebsite('${site.fullUrl}', ${index})" 
                                    style="background: #2ecc71; width: 100%;">
                                ‚ñ∂Ô∏è Visit Website
                            </button>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
                            <span id="visitCount-${index}">Visits: 0</span>
                        </div>
                    </div>
                `;
            });
            
            grid.innerHTML = html;
        }
        
        function visitWebsite(url, index) {
            // Open in new tab for REAL Google Analytics tracking
            window.open(url + '?utm_source=academy&utm_medium=csv_tool&utm_campaign=research', '_blank');
            
            // Update visit count
            const visitElement = document.getElementById(`visitCount-${index}`);
            if (visitElement) {
                const currentText = visitElement.textContent;
                const match = currentText.match(/Visits: (\d+)/);
                const currentVisits = match ? parseInt(match[1]) : 0;
                visitElement.textContent = `Visits: ${currentVisits + 1}`;
            }
            
            showNotification("üåê Website opened in new tab - Google Analytics will see this!");
        }
        
        function downloadSampleCSV() {
            const sampleCSV = `finelinebeats.com,My Music Portfolio
example.com,Example Website
wikipedia.org,Wikipedia
youtube.com,YouTube
github.com,GitHub
google.com,Google
amazon.com,Amazon
facebook.com,Facebook
twitter.com,Twitter
instagram.com,Instagram`;
            
            const blob = new Blob([sampleCSV], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            a.href = url;
            a.download = 'sample_websites.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification("üì• Sample CSV downloaded!");
        }
        
        function addDemoWebsites() {
            const demoWebsites = [
                { url: "finelinebeats.com", name: "Music Portfolio" },
                { url: "example.com", name: "Example Site" },
                { url: "wikipedia.org", name: "Wikipedia" },
                { url: "youtube.com", name: "YouTube" },
                { url: "github.com", name: "GitHub" }
            ].map(site => ({
                ...site,
                fullUrl: 'https://' + site.url
            }));
            
            loadWebsites(demoWebsites);
            showNotification("üéÆ Demo websites loaded!");
        }
        
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Initialize with demo websites
        window.addEventListener('load', function() {
            addDemoWebsites();
        });
    </script>
</body>
</html>
